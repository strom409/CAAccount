@using BlazorDemo.AbraqAccount.Services.Interfaces
@implements IDisposable
@inject INotificationService NotificationService

<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999">
    @foreach (var toast in toasts)
    {
        <div class="toast show animate__animated animate__fadeInRight @GetToastClass(toast.Type)" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">@toast.Type.ToString()</strong>
                <button type="button" class="btn-close" @onclick="() => RemoveToast(toast)"></button>
            </div>
            <div class="toast-body">
                @toast.Message
            </div>
        </div>
    }
</div>

<style>
    .toast { min-width: 250px; margin-bottom: 10px; border-radius: 8px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .toast-success { border-left: 5px solid #28a745; background: #f8fff9; }
    .toast-error { border-left: 5px solid #dc3545; background: #fff8f8; }
    .toast-warning { border-left: 5px solid #ffc107; background: #fffdf4; }
    .toast-info { border-left: 5px solid #17a2b8; background: #f4fcff; }
    .animate__animated { animation-duration: 0.5s; }
    @@keyframes fadeInRight { from { opacity: 0; transform: translate3d(100%, 0, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }
    .animate__fadeInRight { animation-name: fadeInRight; }
</style>

@code {
    private List<ToastMessage> toasts = new();

    protected override void OnInitialized()
    {
        NotificationService.OnShow += HandleShow;
    }

    private async void HandleShow(string message, NotificationType type)
    {
        var toast = new ToastMessage { Message = message, Type = type };
        toasts.Add(toast);
        await InvokeAsync(StateHasChanged);

        // Auto remove after 5 seconds
        await Task.Delay(5000);
        RemoveToast(toast);
    }

    private void RemoveToast(ToastMessage toast)
    {
        if (toasts.Contains(toast))
        {
            toasts.Remove(toast);
            InvokeAsync(StateHasChanged);
        }
    }

    private string GetToastClass(NotificationType type) => type switch
    {
        NotificationType.Success => "toast-success",
        NotificationType.Error => "toast-error",
        NotificationType.Warning => "toast-warning",
        NotificationType.Info => "toast-info",
        _ => ""
    };

    public void Dispose()
    {
        NotificationService.OnShow -= HandleShow;
    }

    private class ToastMessage
    {
        public string Message { get; set; } = "";
        public NotificationType Type { get; set; }
    }
}
