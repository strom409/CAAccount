@page "/PAckingDraftLedger"
@inject ProtectedLocalStorage ProtectedLocalStore
@using System.Linq
@using System.Linq.Dynamic.Core
@using DevExpress.Data.Linq
@using DevExpress.Data.Filtering
@using DevExpress.XtraReports.UI
@using DevExpress.Blazor.Reporting
@using Microsoft.AspNetCore.Components.Web
@using System.IO
@inject EmployeeAdoNetService EmployeeService
@using System.Text.RegularExpressions;
@using BlazorDemo.Services;
@using BlazorDemo;
@using ClosedXML.Excel;
@inject IJSRuntime JS
<PageTitle>Packing Draft Ledger</PageTitle>

@inject NavigationManager NavigationManager
<link href="_content/DevExpress.Blazor.Themes/blazing-berry.bs5.min.css" rel="stylesheet" />
<link rel="stylesheet" href="_content/DevExpress.Blazor.Reporting.Viewer/css/dx-blazor-reporting-components.bs5.css">
<br />
<div class="container-fluid px-0">
    <div class="d-flex align-items-center mb-2" style="margin-top: -10px;">
        <h5 class="mb-0 me-3"><strong>Packing Draft Ledger</strong></h5>
        <button @onclick="GoBack" class="btn btn-primary btn-sm ms-3">
            <!-- Added ms-3 -->
            <i class="fa fa-arrow-left"></i>
        </button>
    </div>
</div>
<!-- Your existing content continues here -->
<br />

   <div class="card p-3 mb-4" style="border: 1px solid lightgray; background-color: #f5f5f5;">
    <div class="row g-3 align-items-end">
        <!-- Date From -->
        <div class="col-sm-2">
            <label for="date1" class="form-label">Dated From</label>
            <DxDateEdit @bind-Date="EditModel.draftdatefrom"
                       CssClass="cw-320"
                       style="height: 30px;" InputId="date1" />
        </div>

        <!-- Date To -->
        <div class="col-sm-2">
            <label for="date2" class="form-label">Dated To</label>
            <DxDateEdit @bind-Date="EditModel.DraftDateTo"
                       CssClass="cw-320"
                       style="height: 30px;" InputId="date2" />
        </div>
         <div class="col-md-2">
            <label for="growerGroup" class="form-label">Grower Group Name</label>
            <DxComboBox @key="GrowerGroupKey" 
                       Data="@GetgrowerList"
                       SearchMode="@SearchMode"
                       SearchFilterCondition="@SearchFilterCondition"
                       SearchTextParseMode="@SearchTextParseMode"
                       ValueChanged="@(async (string? newValue) => await OnGrowerGroupChanged(newValue))"
                       TextFieldName="GrowerName"
                       ValueFieldName="GrowerName"
                       CssClass="cw-480"
                       Value="@EditModel.GrowerGroupName"
                       InputId="growerGroup" 
                      NullText="Grower Group"
                       ClearButtonDisplayMode="DataEditorClearButtonDisplayMode.Auto" />
        </div>

        <div class="col-sm-2">
            <label for="reportType" class="form-label">Stock Type</label>
            <select id="stockType" class="form-select form-select-sm w-100"
                    style="height: 30px;" @bind="EditModel.stockType" required>
                <option disabled selected value="">Select</option>
                <option value="Available">Available</option>
                <option value="Finished">Finished</option>
                <option value="ALL">ALL</option>


            </select>
        </div>
        <!-- Grower Group Name -->
      

        <!-- Grower Name -->
    <!-- Product Name -->

        <!-- UOM -->

        <!-- Vehicle No -->
<!-- Common Search -->
<!-- Report Type -->
        <div class="col-sm-2">
            <label for="reportType" class="form-label">Report Type</label>
            <select id="reportType" class="form-select form-select-sm w-100"
                    style="height: 30px;" @bind="EditModel.ReportType" required>
                <option disabled selected value="">Select</option>
                <option value="Aggregate">Aggregate</option>
                <option value="Detailed">Detailed</option>
              

            </select>
        </div>

      

        <!-- Action Buttons - Now properly aligned -->
        <div class="col-sm-2">
            <label class="form-label">Actions</label>
            <div class="d-grid gap-2 d-md-flex">
                <button type="button" @onclick="SearchCrates" class="btn btn-sm flex-fill" style="background-color: #616567; border-color: #dee2e6; color:white;">
                    <i class="fas fa-search"></i> Search
                </button>
                
               
                <button type="button" @onclick="ClearFilter" class="btn btn-secondary btn-sm flex-fill">
                    Clear
                </button>
            </div>
        </div>
    </div>
</div>

@if (isGeneratingReport)
{
    <div class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}

<style>
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
</style>

<style>
    @@media (max-width: 768px) {
        .dxbl-grid {
            width: 768px; /* Force minimum width */
        }
    }

    .alt-item {
        background-color: rgba(243, 244, 245, 1) !important;
    }

        .alt-item > td {
            --dxbl-grid-bg: rgba(243, 244, 245, 1) !important;
            background-color: rgba(243, 244, 245, 1) !important;
        }
</style>

<style>
    .grid-scroll-container {
        overflow-x: auto;
        width: 100%;
        /* Prevent vertical scrollbar if not needed */
        overflow-y: hidden;
    }

        /* WebKit browsers */
        .grid-scroll-container::-webkit-scrollbar {
            height: 6px;
        }

        .grid-scroll-container::-webkit-scrollbar-button:single-button {
            display: none; /* Remove arrows */
        }

        .grid-scroll-container::-webkit-scrollbar-track {
            background: #f8f9fa;
            border-radius: 3px;
        }

        .grid-scroll-container::-webkit-scrollbar-thumb {
            background: #6c757d;
            border-radius: 3px;
        }

            .grid-scroll-container::-webkit-scrollbar-thumb:hover {
                background: #495057;
            }

        /* Remove corner where vertical and horizontal scrollbars meet */
        .grid-scroll-container::-webkit-scrollbar-corner {
            background: transparent;
        }

    /* Firefox */
    .grid-scroll-container {
        scrollbar-width: thin; /* 'auto' or 'thin' */
        scrollbar-color: #6c757d #f8f9fa;
    }

    /* IE and Edge */
    .grid-scroll-container {
        -ms-overflow-style: -ms-autohiding-scrollbar;
    }
</style>
<div class="grid-scroll-container">

    <DxGrid Data="@Growerslots" FilterCriteriaChanged="@OnFilterCriteriaChanged" @ref="myGrid" PageSize="1000" 
            PageSizeSelectorVisible="true"
            PageSizeSelectorItems="@(new int[] {5, 10, 25, 50, 100, 150, 200, 250, 300, 350, 400, 500 })"
            PageSizeSelectorAllRowsItemVisible="true" ShowSearchBox="true"
            ShowGroupPanel="false" FilterMenuButtonDisplayMode="GridFilterMenuButtonDisplayMode.Always"
            ColumnResizeMode="GridColumnResizeMode.NextColumn" CustomizeElement="Grid_CustomizeElement"  TextWrapEnabled="true">
        <ToolbarTemplate>
            <div class="col-sm-2">
                <label class="form-label">Actions</label>
                <div class="d-grid gap-2 d-md-flex">
                   
                 @*    <button type="button" @onclick="GenerateExcel" class="btn btn-sm flex-fill" style="background-color: #198754; border-color: #198754; color: white;">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                    <button type="button" @onclick="SearchReport" class="btn btn-sm flex-fill" style="background-color: white; border-color: #dee2e6; color: #333;">
                        <i class="fas fa-document"></i> Report
                    </button>
                    
                    <button type="button" @onclick="ClearFilter" class="btn btn-secondary btn-sm flex-fill">
                        Clear
                    </button> *@
                </div>
            </div>
        </ToolbarTemplate>
        <Columns>
            @if (Aggflag)
            {
                <!-- Aggregated columns -->
                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeName) MinWidth="100" Caption="Recipe" Width="30%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeGrade) MinWidth="100" DisplayFormat="F0" Caption="Grade" Width="20%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeMarka) MinWidth="100" DisplayFormat="F0" Caption="Marka" Width="20%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeQty) MinWidth="100" DisplayFormat="F0" Caption="Draft Qty" Width="20%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.PackingQty) MinWidth="100" DisplayFormat="F0" Caption="Packed Qty" Width="20%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.Recipebalance) MinWidth="100" DisplayFormat="F0" Caption="Balance" Width="20%" />
            }
            else if (Detflag)
            {
                <!-- Detailed columns -->
                <DxGridDataColumn FieldName=@nameof(companyModel.DraftIrn) MinWidth="100" Caption="Draft IRN" Width="15%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.PalletName) MinWidth="100" Caption="Pallet" Width="10%" />



                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeName) MinWidth="100" Caption="Recipe" Width="10%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeGrade) MinWidth="100" DisplayFormat="F0" Caption="Grade" Width="10%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeMarka) MinWidth="100" DisplayFormat="F0" Caption="Marka" Width="10%" />
                 <DxGridDataColumn FieldName=@nameof(companyModel.VarietyId) MinWidth="100" DisplayFormat="F0" Caption="Variety" Width="10%" />
                
                
                <DxGridDataColumn FieldName=@nameof(companyModel.ReceipeQty) MinWidth="100" DisplayFormat="F0" Caption="Draft Qty" Width="10%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.PackingQty) MinWidth="100" DisplayFormat="F0" Caption="Packed Qty" Width="10%" />
                <DxGridDataColumn FieldName=@nameof(companyModel.Recipebalance) MinWidth="100" DisplayFormat="F0" Caption="Balance" Width="5%" />
            }

        </Columns>


        <TotalSummary>
            <DxGridSummaryItem SummaryType="GridSummaryItemType.Sum" ValueDisplayFormat="F0" FieldName="@nameof(companyModel.ReceipeQty)" />
            <DxGridSummaryItem SummaryType="GridSummaryItemType.Sum" ValueDisplayFormat="F0" FieldName="@nameof(companyModel.PackingQty)" />
            <DxGridSummaryItem SummaryType="GridSummaryItemType.Sum" ValueDisplayFormat="F0" FieldName="@nameof(companyModel.Recipebalance)" />
          
        </TotalSummary>


    </DxGrid>
</div>


<style>
    .even-row {
        background-color: #f5f5f5; /* light gray */
    }

    .odd-row {
        background-color: white;
    }
</style>


@if (showReport)
{
    <div style="overflow-x:auto; width:100%;">
        <DxReportViewer @ref="reportViewer" Zoom="0.9" Report="@Report">
        </DxReportViewer>
    </div>
}
        }
         
 

            <style>
                @@media (max-width: 768px) {
                    .dxbl-grid {
                        width: 768px; /* Force minimum width */
                    }
                }

                .alt-item {
                    background-color: rgba(243, 244, 245, 1) !important;
                }

                    .alt-item > td {
                        --dxbl-grid-bg: rgba(243, 244, 245, 1) !important;
                        background-color: rgba(243, 244, 245, 1) !important;
                    }
           
            
            
            
            </style>


    


<style>
    .centered-field {
        display: flex;
        flex-direction: column;
        align-items: center; /* centers children horizontally */
    }

        .centered-field label {
            text-align: center; /* centers the label’s text */
            width: 100%; /* ensure the label fills the container */
            margin-bottom: .5rem;
        }

        .centered-field input {
            width: 200px; /* or whatever width you like */
        }

    /* Slightly darker but still subtle placeholder */
    .input-placeholder-dim::placeholder {
        color: rgba(130, 130, 130, 0.3) !important; /* dim gray, 30% opacity */
        opacity: 1 !important;
    }

    /* Dark gray border on focus, no shadow */
    .input-focus-dark:focus {
        border-color: #343a40; /* dark gray */
        box-shadow: none !important;
        outline: none;
    }

    .table-responsive {
        overflow-x: auto;
        width: 100%;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem; /* optional small font */
    }

        .table th, .table td {
            padding: 0.5rem;
            text-align: left;
        }

    .zebra-table tbody tr:nth-child(odd) {
        background-color: white;
    }

    .zebra-table tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }




    /* Custom small font */
    .small-font {
        font-size: 0.82rem;
    }

    .control-wrapper {
        max-width: 250px;
        margin: 0 auto;
        padding: 50px 0px 0px;
    }

    .example-label {
        font-size: 14px;
        margin-bottom: 6px;
        /* Standardize form control styles for horizontal alignment */
        input .form-control, .e-input-group, .e-control-wrapper, .e-autocomplete, .e-input

    {
        min-height: 38px; /* Bootstrap default */
        line-height: 1.5;
        font-size: 14px;
        font-family: 'Source Sans Pro', sans-serif;
        padding: 6px 12px;
        box-sizing: border-box;
    }

    /* Optional: Align content inside Syncfusion AutoComplete */
    .e-autocomplete .e-input {
        padding: 6px 12px !important;
    }

    /* Remove extra bottom spacing in SfAutoComplete wrapper */
    .e-autocomplete.e-control-wrapper {
        margin-bottom: 0 !important;
    }

    /* Align labels consistently */
    label.form-label {
        font-size: 14px;
        margin-bottom: 4px;
        font-family: 'Source Sans Pro', sans-serif;
    }

    /* Remove extra vertical margin if any Syncfusion adds it */
    .e-control-wrapper {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
    }

</style>


<style>
    .alt-item {
        background-color: rgba(243, 244, 245, 1) !important;
    }

        .alt-item > td {
            --dxbl-grid-bg: rgba(243, 244, 245, 1) !important;
            background-color: rgba(243, 244, 245, 1) !important;
        }
</style>

<DxDialogProvider />

<DxPopup @bind-Visible="@isDialogVisible"
         HeaderText="Confirmation"
         ShowCloseButton="true"
         CssClass="validation-dialog">
    <Content>
        Are you sure you want to change the status for Item ID: <strong>@selectedGrowerId</strong>?
        <div>
        <DxButton RenderStyle="ButtonRenderStyle.Primary" Click="@OnConfirmYes">Yes</DxButton>
        <DxButton RenderStyle="ButtonRenderStyle.Secondary" Click="@OnConfirmNo">No</DxButton>
        </div>
    </Content>
   
</DxPopup>


<DxPopup @bind-Visible="@DeleteDialog"
         HeaderText="Confirmation"
         ShowCloseButton="true"
         CssClass="validation-dialog">
    <Content>
        Are you sure you want to delete the  Item Id: <strong>@selectedGrowerId</strong>?
        <div>
            <DxButton RenderStyle="ButtonRenderStyle.Primary" Click="@OnConfirmYesDelete">Yes</DxButton>
            <DxButton RenderStyle="ButtonRenderStyle.Secondary" Click="@OnConfirmNoDelete">No</DxButton>
        </div>
    </Content>

</DxPopup>



<DxPopup @bind-Visible="@PostDialog"
         HeaderText="Confirmation"
         ShowCloseButton="true"
         CssClass="validation-dialog">
    <Content>
        Are you sure you want to Post the  Order Id: <strong>@selectedGrowerId</strong>?
        <div>
            <DxButton RenderStyle="ButtonRenderStyle.Primary" Click="@OnConfirmYesPost">Yes</DxButton>
            <DxButton RenderStyle="ButtonRenderStyle.Secondary" Click="@OnConfirmNoDelete">No</DxButton>
        </div>
    </Content>

</DxPopup>




<DxPopup @bind-Visible="@UnPostDialog"
         HeaderText="Confirmation"
         ShowCloseButton="true"
         CssClass="validation-dialog">
    <Content>
        Are you sure you want to UnPost the  Order Id: <strong>@selectedGrowerId</strong>?
        <div>
            <DxButton RenderStyle="ButtonRenderStyle.Primary" Click="@OnConfirmYesUnpost">Yes</DxButton>
            <DxButton RenderStyle="ButtonRenderStyle.Secondary" Click="@OnConfirmNoDelete">No</DxButton>
        </div>
    </Content>

</DxPopup>











<DxPopup @bind-Visible="@PurDialog"
         HeaderText="Confirmation"
         ShowCloseButton="true"
         CssClass="validation-dialog">
    <Content>
        Are you sure you want to generate new Purchase order?
        <div>
            <DxButton RenderStyle="ButtonRenderStyle.Primary" Click="@OnConfirmYesGenerate">Yes</DxButton>
            <DxButton RenderStyle="ButtonRenderStyle.Secondary" Click="@OnConfirmNoGenerate">No</DxButton>
        </div>
    </Content>

</DxPopup>






@if (ShowEmptyFieldDialog)
{
    <DxPopup @bind-Visible="@ShowEmptyFieldDialog"
             HeaderText="Validation Error"
             ShowCloseButton="true"
             CssClass="validation-dialog">
        <Content>
            <p>@DialogMessage</p>
            <DxButton Text="OK" Click="@(() => ShowEmptyFieldDialog = false)" />
        </Content>
    </DxPopup>
}
<style>
    .custom-popup-style {
        background-color: #fdfdfd;
        border: 2px solid #0078d4;
        border-radius: 12px;
        padding: 10px;
        font-family: 'Segoe UI', sans-serif;
    }

        .custom-popup-style .dxbs-popup-header {
            background-color: #0078d4;
            color: white;
            font-weight: bold;
            border-bottom: none;
        }

        .custom-popup-style .dxbs-popup-content {
            font-size: 15px;
            padding: 15px;
        }
</style>
@if (ShowEmptyFieldDialogError)
{
    <DxPopup @bind-Visible="@ShowEmptyFieldDialogError"
             HeaderText="Confirmation Message"
             ShowCloseButton="true"
             CssClass="custom-popup-style">



        <Content>
            <p><strong>Success </strong>@DialogMessage</p>
            <DxButton Text="OK" RenderStyle="ButtonRenderStyle.Primary" Click="@(() => ShowEmptyFieldDialogError = false)" />
        </Content>
    </DxPopup>
}











@code {
    DxGrid myGrid;
    private bool isExporting = false;
    private string successMessage = string.Empty;
    private string errorMessage = string.Empty;

    ListSearchMode SearchMode { get; set; } = ListSearchMode.AutoSearch;
    ListSearchFilterCondition SearchFilterCondition { get; set; } = ListSearchFilterCondition.Contains;
    ListSearchTextParseMode SearchTextParseMode { get; set; } = ListSearchTextParseMode.GroupWordsByAnd;
    List<CompanyModel> GetmasterGroup = new List<CompanyModel>();
    List<CompanyModel> GetgrowerList = new List<CompanyModel>();
    List<CompanyModel> Purchaseorders = new List<CompanyModel>();
    List<CompanyModel> Growerslots = new List<CompanyModel>();
    List<CompanyModel> GetVehlist = new List<CompanyModel>();

    private bool isGeneratingReport = false;

    private bool Detflag = false;

    private bool Aggflag = false;



    List<CompanyModel> GetDailyCrates = new List<CompanyModel>();
    string AvailGrower ="";
    private IGrid grid;
    bool showReport = false;
    List<CompanyModel> GetCrateMark = new List<CompanyModel>();
    List<CompanyModel> GetChallanGroup = new List<CompanyModel>();

    List<CompanyModel> CrateAnalysis = new List<CompanyModel>();
    List<CompanyModel> GetSubGrowerGroup = new List<CompanyModel>();


    DxReportViewer? reportViewer;
    XtraReport? Report;
    private async void ShowReport()
    {


        GetDailyCrates = await EmployeeService.generatePreinwardReport(EditModel);

        Report = XtraReport.FromFile(Path.Combine(Directory.GetCurrentDirectory(),
             @"Reports\PreinwardReport.repx"));

        showReport = true;
    }










    private decimal AvailableGrower = 0;
    private decimal AvailableSubGrower = 0;

    private CompanyModel EditModel = new();
    private string DialogMessage { get; set; } = "";
    private bool ShowEmptyFieldDialogError { get; set; }
    private string ChallanGroup { get; set; } = "";
    string GrowerGroupKey = Guid.NewGuid().ToString();
    string GrowerNameKey = Guid.NewGuid().ToString();
    string ChallanKey = Guid.NewGuid().ToString();

    private bool ShowEmptyFieldDialog { get; set; }
    private bool ShowCrateAnalysis { get; set; } = false;

    private void DeleteGrower(int growerId)
    {
        selectedGrowerId = growerId;
        DeleteDialog = true;


    }
    private void ViewGrower(int growerId)
    {
        companyModel.Growerid = growerId;


        NavigationManager.NavigateTo($"/ViewGrower/{growerId}");

    }


    private void OnFilterCriteriaChanged(GridFilterCriteriaChangedEventArgs e)
    {
        // You can use the event args (e.FilterCriteria) if needed,
        // but calling RefreshSummary() on the grid instance is usually enough
        // to update summaries based on the internal, current filter.
        myGrid.RefreshSummary();
        // Or for total summaries specifically: Grid.UpdateTotalSummary();
    }
    private async Task OnCountryChanged(string? newCountryId)
    {
        string selectedPurchase = "";
        selectedPurchase = newCountryId;




        EditModel.PurchGrp = selectedPurchase;
        GetItemGroup = await EmployeeService.GetItemNameByGroup(selectedPurchase);
        GetVehlist = await EmployeeService.GetallVeh();


    }


    private async Task OnGrowerGroupChanged(string? newCountryId)
    {
        string selectedPurchase = "";
        selectedPurchase = newCountryId;
        GetSubGrowerGroup.Clear();
        EditModel.GrowerName = String.Empty;
        StateHasChanged();
        if (string.IsNullOrEmpty(newCountryId))
        {
            EditModel.GrowerGroupName = null;
            companyModel.Partyid = 0;

        }


        if (!string.IsNullOrWhiteSpace(selectedPurchase))

        {

            GetSubGrowerGroup = await EmployeeService.GetSubGrowerByGroup(selectedPurchase);
            AvailGrower =selectedPurchase;
            EditModel.GrowerGroupName = AvailGrower;
            // string selectedflag=EditModel.CrissueFlag;
            // GetCrateAnalysis = await EmployeeService.CheckCratesPartyOut(selectedPurchase,selectedflag);
            // AvailableGrower = companyModel.CrateAvailable ?? 0;

            // ShowCrateAnalysis = true;
        }
    }

    protected async Task SearchExcel()


    {


        if (string.IsNullOrWhiteSpace(EditModel.ReportType))
        {
            DialogMessage = "Please Select  Report  Type";
            ShowEmptyFieldDialog = true;
            return;

        }


        List<CompanyModel> FilteredDataList;



        CriteriaOperator filterCriteria = myGrid.GetFilterCriteria();
        if (filterCriteria != null)
        {

            string filterString = CriteriaToWhereClauseHelper.GetDynamicLinqWhere(filterCriteria);
            FilteredDataList = Growerslots.AsQueryable().Where(filterString).ToList();

        }
        else
        {
            FilteredDataList = Growerslots.ToList();
        }



        StateHasChanged();

        if (!FilteredDataList.Any())
        {
            DialogMessage = "No data selected";
            ShowEmptyFieldDialog = true;
            return;
        }






        int ltno = 0;
        foreach (var item in FilteredDataList)
        {



            ltno= item.Lotno;

            await EmployeeService.AddReportData(ltno);

        }



        var validationResult = await EmployeeService.FilterOutReporData();

        var reportPath = "";



        if (EditModel.ReportType == "Inward")
        {
            reportPath = Path.Combine(Directory.GetCurrentDirectory(), @"Reports\inwardReport.repx");

        }
        else if (EditModel.ReportType == "Quality")
        {
            reportPath = Path.Combine(Directory.GetCurrentDirectory(), @"Reports\QualityReport.repx");

        }


        // JS.InvokeVoidAsync("alert", reportPath);




        var report = XtraReport.FromFile(reportPath);
        isGeneratingReport = true; // show the indicator
        StateHasChanged();

        report.CreateDocument(false);

        // Create a new MemoryStream
        var stream = new MemoryStream();

        var exportOptions = new DevExpress.XtraPrinting.XlsxExportOptions
            {
                SheetName = "Exported Report",
                ShowGridLines = true,
                ExportMode = DevExpress.XtraPrinting.XlsxExportMode.SingleFile,
                RawDataMode = true
            };

        // Export the report to the stream
        report.ExportToXlsx(stream, exportOptions);
        stream.Position = 0; // Reset stream position

        // Pass the stream reference to JavaScript without disposing it
        await JS.InvokeVoidAsync(
            "downloadFileFromStream",
            "Report.xlsx",
            new DotNetStreamReference(stream)

        );


        isGeneratingReport = false; // hide the indicator
        myGrid.ClearFilter(); // [citation:1]
        GetDailyCrates = await EmployeeService.generateinwardReport(EditModel);

        Growerslots = await EmployeeService.Getsearchstock();


        StateHasChanged();
    }

    protected async Task SearchReport()
    {


        if (string.IsNullOrWhiteSpace(EditModel.ReportType))
        {
            DialogMessage = "Please Select Report Type";
            ShowEmptyFieldDialog = true;
            return;
        }

        List<CompanyModel> FilteredDataList;



        CriteriaOperator filterCriteria = myGrid.GetFilterCriteria();
        if (filterCriteria != null)
        {

            string filterString = CriteriaToWhereClauseHelper.GetDynamicLinqWhere(filterCriteria);
            FilteredDataList = Growerslots.AsQueryable().Where(filterString).ToList();

        }
        else
        {
            FilteredDataList = Growerslots.ToList();
        }



        StateHasChanged();

        if (!FilteredDataList.Any())
        {
            DialogMessage = "No data selected";
            ShowEmptyFieldDialog = true;
            return;
        }






        int ltno = 0;
        foreach (var item in FilteredDataList)
        {



            ltno = item.Lotno;

            await EmployeeService.AddReportData(ltno);

        }



        var validationResult = await EmployeeService.FilterOutReporData();

        // ... rest of your report generation code ...

        if (EditModel.ReportType == "Inward")
        {
            await JS.InvokeVoidAsync("window.open", "/InwardPreview", "_blank");
            await Task.Delay(100);
        }
        else if (EditModel.ReportType == "Quality")
        {
            await JS.InvokeVoidAsync("window.open", "/QualityPreview", "_blank");
            await Task.Delay(100);
        }

        isGeneratingReport = false;

        myGrid.ClearFilter();
        GetDailyCrates = await EmployeeService.generateinwardReport(EditModel);
        Growerslots = await EmployeeService.Getsearchstock();
        StateHasChanged();
    }

    protected async Task SearchPdf()


    {

        if (string.IsNullOrWhiteSpace(EditModel.ReportType))
        {
            DialogMessage = "Please Select  Report  Type";
            ShowEmptyFieldDialog = true;
            return;

        }

        List<CompanyModel> FilteredDataList;

        CriteriaOperator filterCriteria = myGrid.GetFilterCriteria();
        if (filterCriteria != null)
        {

            string filterString = CriteriaToWhereClauseHelper.GetDynamicLinqWhere(filterCriteria);
            FilteredDataList = Growerslots.AsQueryable().Where(filterString).ToList();

        }
        else
        {
            FilteredDataList = Growerslots.ToList();
        }



        StateHasChanged();

        if (!FilteredDataList.Any())
        {
            DialogMessage = "No data selected";
            ShowEmptyFieldDialog = true;
            return;
        }





        int ltno = 0;
        foreach (var item in FilteredDataList)
        {



            ltno = item.Lotno;

            await EmployeeService.AddReportData(ltno);

        }



        var validationResult = await EmployeeService.FilterOutReporData();

        var reportPath = "";



        if (EditModel.ReportType == "Inward")
        {
            reportPath = Path.Combine(Directory.GetCurrentDirectory(), @"Reports\inwardReport.repx");

        }
        else if (EditModel.ReportType == "Quality")
        {
            reportPath = Path.Combine(Directory.GetCurrentDirectory(), @"Reports\QualityReport.repx");

        }


        // JS.InvokeVoidAsync("alert", reportPath);




        var report = XtraReport.FromFile(reportPath);
        isGeneratingReport = true; // show the indicator
        StateHasChanged();

        report.CreateDocument(false);

        string pdfPath = Path.Combine(Path.GetTempPath(), "QualityReport.pdf");

        await Task.Run(() =>
        {
            report.ExportToPdf(pdfPath);
        });

        // Read the PDF file as bytes
        byte[] pdfBytes = await File.ReadAllBytesAsync(pdfPath);

        // Trigger download using IJSRuntime
        await JS.InvokeVoidAsync("downloadFile",
            Convert.ToBase64String(pdfBytes),
            "Report.pdf",
            "application/pdf");

        // Optional: Clean up the temporary file
        File.Delete(pdfPath);

        isGeneratingReport = false; // hide the indicator
        myGrid.ClearFilter(); // [citation:1]
        GetDailyCrates = await EmployeeService.generateinwardReport(EditModel);

        Growerslots = await EmployeeService.Getsearchstock();


        StateHasChanged();
    }


    private async Task OnSubgrowerChanged(string? newCountryId)
    {
        string selectedPurchase = newCountryId;


        string SelectedSubgrower = AvailGrower;
        GetChallanGroup.Clear();
        EditModel.ChallanName = String.Empty;
        StateHasChanged();
        if (string.IsNullOrEmpty(newCountryId))
        {


            EditModel.GrowerName = null;
            return;
        }






        // await JS.InvokeVoidAsync("alert",selectedPurchase);
        //          await JS.InvokeVoidAsync("alert",AvailGrower);

        if (!string.IsNullOrWhiteSpace(selectedPurchase) && !string.IsNullOrWhiteSpace(SelectedSubgrower))
        {
            EditModel.GrowerName = selectedPurchase;


            GetChallanGroup = await EmployeeService.GetChallanByGroup(selectedPurchase, SelectedSubgrower);
            //    string selectedflag=EditModel.CrissueFlag;

            // GetCrateAnalysis = await EmployeeService.CheckCratesPartysubOut(selectedPurchase, SelectedSubgrower,selectedflag);
            // selectedSubgrower = selectedPurchase;
            // AvailableSubGrower =   companyModel.CrateAvailable ?? 0;

            // ShowCrateAnalysis = true;
        }
        else
        {
            // Optionally reset related values
            ShowCrateAnalysis = false;
            AvailableSubGrower = 0;
        }

    }

    protected async Task GeneratePreview()
    {


        DateTime DateFrom = EditModel.CrateDatefrom ?? DateTime.Now;
        DateTime Dateto = EditModel.CrateDateto ?? DateTime.Now;
        if (string.IsNullOrWhiteSpace(EditModel.GrowerGroupName))
        {
            companyModel.Partyid = 0;
        }
        else
        {
            var partyId = GetNumberBeforeHyphen(EditModel.GrowerGroupName);
            companyModel.Partyid = partyId.HasValue ? partyId.Value : 0;
        }



        if (string.IsNullOrWhiteSpace(EditModel.GrowerName))
        {
            companyModel.Growerid = 0;
        }
        else
        {
            var subPartyId = GetNumberBeforeHyphen(EditModel.GrowerName);
            companyModel.Growerid = subPartyId.HasValue ? subPartyId.Value : 0;
        }

        if (string.IsNullOrWhiteSpace(EditModel.ChallanName))
        {
            companyModel.ChallanId = 0;
        }
        else
        {
            var Challanid = GetNumberBeforeHyphen(EditModel.ChallanName);
            companyModel.ChallanId = Challanid.HasValue ? Challanid.Value : 0;
        }

        if (string.IsNullOrWhiteSpace(EditModel.CrissueMark))
        {
            companyModel.CrissueMark = "PAX2";
        }
        if (string.IsNullOrWhiteSpace(EditModel.CrissueFlag))
        {
            companyModel.CrissueFlag = "PAX2";
        }

        if (string.IsNullOrWhiteSpace(EditModel.vehname))
        {
            companyModel.vehname = "PAX2";
        }

        GetDailyCrates=await EmployeeService.generateCrateReport(EditModel);

        Report = XtraReport.FromFile(Path.Combine(Directory.GetCurrentDirectory(),
          @"Reports\CrateTransaction.repx"));



        showReport = true;

    }



    protected async Task GeneratePreviewbyid(int growerId)
    {


        // if  (EditModel.CrissueId <= 0)
        // {
        //     DialogMessage = "Please enter a valid idno greater than 0.";
        //     ShowEmptyFieldDialog = true;
        //     return;
        // }
        selectedGrowerId = growerId;
        //  selectedGrowerId = EditModel.CrissueId;

        await EmployeeService.GenerateCratePreview(selectedGrowerId,EditModel);

        Report = XtraReport.FromFile(Path.Combine(Directory.GetCurrentDirectory(),
          @"Reports\CrateSlip.repx"));



        showReport = true;

    }






    private void AddGrowerAgreement(int growerId)
    {
        companyModel.Growerid = growerId;


        NavigationManager.NavigateTo($"/EditGrowerAgreement/{growerId}");

    }






    private void ViewSubGrower(int growerId)
    {
        companyModel.Growerid = growerId;


        NavigationManager.NavigateTo($"/ViewSubGrower/{growerId}");

    }


    void OnCrissueMarkChanged(string newValue)
    {
        // Check if the new value is not already in the data source
        if (string.IsNullOrEmpty(newValue))
        {
            EditModel.CrissueMark = null;


            return;
        }




        EditModel.CrissueMark = newValue;

        // Check if the value exists already
        if (!string.IsNullOrWhiteSpace(newValue) &&
            !GetCrateMark.Any(x => x.CrissueMark.Equals(newValue, StringComparison.OrdinalIgnoreCase)))
        {
            GetCrateMark.Add(new CompanyModel { CrissueMark = newValue });
        }
    }
    protected async Task GenerateExcel()
    {

        try
        {
            isExporting = true;
            successMessage = string.Empty;
            errorMessage = string.Empty;
            StateHasChanged();

            if (string.IsNullOrWhiteSpace(EditModel.ReportType))
            {
                DialogMessage = "Please Select  Export  Type";
                ShowEmptyFieldDialog = true;
                return;

            }
            // Call the export method directly from your repository
            if (EditModel.ReportType == "Inward")
            {

                var fileBytes = await ExportCrateSummaryToExcel();
                var fileName = $"Inward Report_{DateTime.Now:yyyyMMdd_HHmmss}.xlsx";

                await JS.InvokeVoidAsync("downloadFile",
                  Convert.ToBase64String(fileBytes),
                  fileName);


            }


            if (EditModel.ReportType == "Quality")
            {
                var fileBytes = await ExportQualitySummaryToExcel();

                var fileName = $"Quality Report_{DateTime.Now:yyyyMMdd_HHmmss}.xlsx";

                await JS.InvokeVoidAsync("downloadFile",
                  Convert.ToBase64String(fileBytes),
                  fileName);


            }





            successMessage = "Excel file downloaded successfully!";
        }
        catch (Exception ex)
        {
            errorMessage = $"Export failed: {ex.Message}";

        }
        finally
        {
            isExporting = false;
            StateHasChanged();
        }


    }

    private async Task<byte[]> ExportCrateSummaryToExcel()

    {
        DateTime DateFrom = EditModel.PreinwardDate ?? DateTime.Now;
        DateTime Dateto = EditModel.PreinwardDateTo ?? DateTime.Now;
        if (string.IsNullOrWhiteSpace(EditModel.GrowerGroupName))
        {
            companyModel.Partyid = 0;
        }
        else
        {
            var partyId = GetNumberBeforeHyphen(EditModel.GrowerGroupName);
            companyModel.Partyid = partyId.HasValue ? partyId.Value : 0;
        }



        if (string.IsNullOrWhiteSpace(EditModel.GrowerName))
        {
            companyModel.Growerid = 0;
        }
        else
        {
            var subPartyId = GetNumberBeforeHyphen(EditModel.GrowerName);
            companyModel.Growerid = subPartyId.HasValue ? subPartyId.Value : 0;
        }


        if (string.IsNullOrWhiteSpace(EditModel.Itemname))
        {
            companyModel.Itemname = null;
        }







        if (string.IsNullOrWhiteSpace(EditModel.PreInwardUom))
        {
            companyModel.PreInwardUom = null;
        }



        if (string.IsNullOrWhiteSpace(EditModel.vehname))
        {
            companyModel.vehname = null;
        }

        EditModel.Partyid = companyModel.Partyid;
        EditModel.Growerid = companyModel.Growerid;

        GetDailyCrates = await EmployeeService.generateinwardReport(EditModel);


        var data = await EmployeeService.Getsearchstock();

        using (var workbook = new XLWorkbook())
        {
            var worksheet = workbook.Worksheets.Add("Inward Report");

            // Add headers with styling
            var headers = new string[]
            {
            "Dated", "Lotno", "Party", "Grower", "Challan",
            "Challan No", "Khata", "Variety",
            "Vehicle no","Uom","Chamber","Type","Company Crate","Own Crates","Petties","Qty","Bins","Out Qty"
            };
            for (int i = 0; i < headers.Length; i++)
            {
                var cell = worksheet.Cell(1, i + 1);
                cell.Value = headers[i];
                cell.Style.Font.Bold = true;
                cell.Style.Fill.BackgroundColor = XLColor.LightGray;
                cell.Style.Alignment.Horizontal = XLAlignmentHorizontalValues.Center;
                cell.Style.Border.OutsideBorder = XLBorderStyleValues.Thin;
            }

            int row = 2;
            foreach (var item in data)
            {
                worksheet.Cell(row, 1).Value = item.PreinwardDate?.ToString("yyyy-MM-dd") ?? "";
                worksheet.Cell(row, 2).Value = item.LotIrn;
                worksheet.Cell(row, 3).Value = item.GrowerGroupName;
                worksheet.Cell(row, 4).Value = item.GrowerName;
                worksheet.Cell(row, 5).Value = item.ChallanName;

                worksheet.Cell(row, 6).Value = item.ChallanNo;

                worksheet.Cell(row, 7).Value = item.PreInwardKhata;
                worksheet.Cell(row, 8).Value = item.VarietyId;

                worksheet.Cell(row, 9).Value = item.Vehno;
                worksheet.Cell(row, 10).Value = item.Prodname;
                worksheet.Cell(row, 11).Value = item.ChamberName;
                worksheet.Cell(row, 12).Value = item.PreCrateType;
                worksheet.Cell(row, 13).Value = item.VerfiedCompanyCrates;
                worksheet.Cell(row, 14).Value = item.VerfiedOwnCrates;

                worksheet.Cell(row, 15).Value = item.Verfiedpetties;
                worksheet.Cell(row, 16).Value = item.VerfiedQty;
                worksheet.Cell(row, 17).Value = item.Verfiedbins;
                worksheet.Cell(row, 18).Value = item.VerfiedOut;


                row++;
            }

            for (int col = 2; col <= headers.Length; col++)
            {
                worksheet.Column(col).Style.NumberFormat.NumberFormatId = 0; // Number format
            }
            worksheet.Columns().AdjustToContents();

            // Add borders to all cells
            var dataRange = worksheet.Range(1, 1, row - 1, headers.Length);
            dataRange.Style.Border.InsideBorder = XLBorderStyleValues.Thin;
            dataRange.Style.Border.OutsideBorder = XLBorderStyleValues.Medium;
            using (var stream = new MemoryStream())
            {
                workbook.SaveAs(stream);
                return stream.ToArray();
            }
        }

    }


    private async Task<byte[]> ExportQualitySummaryToExcel()
    {
        DateTime DateFrom = EditModel.PreinwardDate ?? DateTime.Now;
        DateTime Dateto = EditModel.PreinwardDateTo ?? DateTime.Now;

        if (string.IsNullOrWhiteSpace(EditModel.GrowerGroupName))
        {
            companyModel.Partyid = 0;
        }
        else
        {
            var partyId = GetNumberBeforeHyphen(EditModel.GrowerGroupName);
            companyModel.Partyid = partyId.HasValue ? partyId.Value : 0;
        }

        if (string.IsNullOrWhiteSpace(EditModel.GrowerName))
        {
            companyModel.Growerid = 0;
        }
        else
        {
            var subPartyId = GetNumberBeforeHyphen(EditModel.GrowerName);
            companyModel.Growerid = subPartyId.HasValue ? subPartyId.Value : 0;
        }

        if (string.IsNullOrWhiteSpace(EditModel.Itemname))
        {
            companyModel.Itemname = null;
        }

        if (string.IsNullOrWhiteSpace(EditModel.PreInwardUom))
        {
            companyModel.PreInwardUom = null;
        }

        if (string.IsNullOrWhiteSpace(EditModel.vehname))
        {
            companyModel.vehname = null;
        }

        EditModel.Partyid = companyModel.Partyid;
        EditModel.Growerid = companyModel.Growerid;

        GetDailyCrates = await EmployeeService.generateinwardReport(EditModel);
        var data = await EmployeeService.GetsearchstockExcel();

        using (var workbook = new XLWorkbook())
        {
            var worksheet = workbook.Worksheets.Add("Quality Report");

            // Add headers with styling
            var headers = new string[]
            {
            "Preinward No", "Lotno", "Dated", "Party", "Grower", "Challan",
            "Khata", "Variety", "Chamber", "Vehicle No","Company Crate", "Own Crates", "Petties",
            "Qty", "Malfunction", "Pressure", "Net Wt/Crate", "Tot Net Wt", "Total Agrade",
            "Total Bgrade", "Agrade Percent", "Bgrade Percent", "Agrade/Crate", "Bgrade/Crate",
            "AvgSize", "Remarks", "Out Qty", "Balance"
            };

            for (int i = 0; i < headers.Length; i++)
            {
                var cell = worksheet.Cell(1, i + 1);
                cell.Value = headers[i];
                cell.Style.Font.Bold = true;
                cell.Style.Fill.BackgroundColor = XLColor.LightGray;
                cell.Style.Alignment.Horizontal = XLAlignmentHorizontalValues.Center;
                cell.Style.Border.OutsideBorder = XLBorderStyleValues.Thin;
            }

            int row = 2;
            foreach (var item in data)
            {
                // Text fields
                worksheet.Cell(row, 1).Value = item.PreInIrn?.ToString() ?? "";
                worksheet.Cell(row, 2).Value = item.LotIrn?.ToString() ?? "";
                worksheet.Cell(row, 3).Value = item.EntryDate?.ToString() ?? "";
                worksheet.Cell(row, 4).Value = item.GrowerGroupName ?? "";
                worksheet.Cell(row, 5).Value = item.GrowerName ?? "";
                worksheet.Cell(row, 6).Value = item.ChallanName ?? "";
                worksheet.Cell(row, 7).Value = item.PreInwardKhata ?? "";
                worksheet.Cell(row, 8).Value = item.VarietyId?.ToString() ?? "";
                worksheet.Cell(row, 9).Value = item.ChamberName ?? "";
                worksheet.Cell(row, 10).Value = item.Vehno ?? "";
                worksheet.Cell(row, 15).Value = item.Scabename ?? "";
                worksheet.Cell(row, 25).Value = item.Avgsizename ?? "";
                worksheet.Cell(row, 26).Value = item.QualityRemarks ?? "";

                // Numeric fields - explicitly convert to decimal
                worksheet.Cell(row, 11).Value = Convert.ToDecimal(item.VerfiedCompanyCrates ?? 0);
                worksheet.Cell(row, 12).Value = Convert.ToDecimal(item.VerfiedOwnCrates ?? 0);
                worksheet.Cell(row, 13).Value = Convert.ToDecimal(item.Verfiedpetties ?? 0);
                worksheet.Cell(row, 14).Value = Convert.ToDecimal(item.VerfiedQty ?? 0);
                worksheet.Cell(row, 16).Value = Convert.ToDecimal(item.AvgPressure ?? 0);
                worksheet.Cell(row, 17).Value = Convert.ToDecimal(item.Netweight ?? 0);
                worksheet.Cell(row, 18).Value = Convert.ToDecimal(item.TotalNetweight ?? 0);
                worksheet.Cell(row, 19).Value = Convert.ToDecimal(item.TotalAgrade ?? 0);
                worksheet.Cell(row, 20).Value = Convert.ToDecimal(item.TotalBgrade ?? 0);
                worksheet.Cell(row, 21).Value = Convert.ToDecimal(item.TotalAgradePercent ?? 0);
                worksheet.Cell(row, 22).Value = Convert.ToDecimal(item.TotalBgradePercent ?? 0);
                worksheet.Cell(row, 23).Value = Convert.ToDecimal(item.TotalAgradepercrate ?? 0);
                worksheet.Cell(row, 24).Value = Convert.ToDecimal(item.TotalBgradepercrate ?? 0);
                worksheet.Cell(row, 27).Value = Convert.ToDecimal(item.VerfiedOut ?? 0);
                worksheet.Cell(row, 28).Value = Convert.ToDecimal(item.VerfiedAvailable ?? 0);
                row++;
            }

            // Apply number formatting to numeric columns
            for (int col = 10; col <= 23; col++) // Columns 10-23 are numeric
            {
                worksheet.Column(col).Style.NumberFormat.NumberFormatId = 2; // Number format
            }

            // Format percentage columns (20, 21)
            worksheet.Column(21).Style.NumberFormat.Format = "0%";
            worksheet.Column(22).Style.NumberFormat.Format = "0%";
            worksheet.Column(11).Style.NumberFormat.Format = "0";
            worksheet.Column(12).Style.NumberFormat.Format = "0";
            worksheet.Column(13).Style.NumberFormat.Format = "0";
            worksheet.Column(14).Style.NumberFormat.Format = "0";
            worksheet.Columns().AdjustToContents();

            // Add borders to all cells
            var dataRange = worksheet.Range(1, 1, row - 1, headers.Length);
            dataRange.Style.Border.InsideBorder = XLBorderStyleValues.Thin;
            dataRange.Style.Border.OutsideBorder = XLBorderStyleValues.Medium;

            using (var stream = new MemoryStream())
            {
                workbook.SaveAs(stream);
                return stream.ToArray();
            }
        }
    }



    private void AddGrower(int growerId)
    {
        companyModel.Growerid = growerId;


        NavigationManager.NavigateTo($"/AddGrower");

    }


    private async Task EditItem(object dataItem)
    {
        if (dataItem is CompanyModel companyModel)
        {
            selectedGrowerId = companyModel.CrissueId;

            GetgrowerList = await EmployeeService.GetallGrowerlist();

            // Growerselect=EditModel.GrowerGroupName;
            // selectedSubgrower = EditModel.GrowerGroupName;
            // await JS.InvokeVoidAsync("alert",EditModel.GrowerGroupName);
            EditModel = await EmployeeService.GetCrateIssueDet(selectedGrowerId);

            GetSubGrowerGroup = await EmployeeService.GetSubGrowerByGroup(EditModel.GrowerGroupName);
            GetChallanGroup = await EmployeeService.GetChallanByGroup(EditModel.GrowerName,EditModel.GrowerGroupName);
            actualidqty = EditModel.CrissueQty ?? 0;

            //  EditModel.GrowerName = GetSubGrowerGroup.FirstOrDefault();
            // selectedSubgrower= EditModel.GrowerName;
            // await JS.InvokeVoidAsync("alert",EditModel.GrowerGroupName);
            // await JS.InvokeVoidAsync("alert",  EditModel.GrowerName);

            // selectedPurchaseGroup = EditModel.PurchGrp;
            // GetItemGroup = await EmployeeService.GetItemNameByGroup(selectedPurchaseGroup);

            StateHasChanged();
        }
    }

    // private async void EditGrower(int growerId)
    // {
    //     // selectedGrowerId=companyModel.Mid ;

    //     // companyModel = await EmployeeService.GetMasterName(companyModel.Mid);



    // }
    protected async Task OnConfirmYes()
    {


        companyModel.Itemid = selectedGrowerId;
        await EmployeeService.UpdateItemStatus(selectedGrowerId, companyModel);


        banks = await EmployeeService.GetallItemGroup();


        StateHasChanged();
        isDialogVisible = false;

    }

    protected async Task OnConfirmYesPost()
    {
        if (EditModel.PurchaseOrderId <= 0)
        {
            DialogMessage = "Please enter a valid Order No";
            ShowEmptyFieldDialog = true;
            return;
        }
        selectedGrowerId = EditModel.PurchaseOrderId;


        selectedItemid = EditModel.PurchaseOrderItemId;

        //  await JS.InvokeVoidAsync("alert", selectedGrowerId);
        // await JS.InvokeVoidAsync("alert", selectedItemid);

        var result = await EmployeeService.PostPurchaseOrder(EditModel);
        if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
        {
            GetOrderDetails = await EmployeeService.GetPurchaseOrder(selectedGrowerId);

            DialogMessage = result.RetMessage;
            ShowEmptyFieldDialogError = true;


            StateHasChanged();
            PostDialog = false; // Close the delete confirmation dialog
            return;
        }



        if (result != null && result.RetFlag.Trim() == "FALSE")
        {

            DialogMessage = result.RetMessage ?? "Failed to delete Item group.";
            ShowEmptyFieldDialog = true;
            PostDialog = false;
            return;
        }

















        StateHasChanged();
        isDialogVisible = false;


    }
    protected async Task OnConfirmYesUnpost()
    {
        if (EditModel.PurchaseOrderId <= 0)
        {
            DialogMessage = "Please enter a valid Order No";
            ShowEmptyFieldDialog = true;
            return;
        }
        selectedGrowerId = EditModel.PurchaseOrderId;


        selectedItemid = EditModel.PurchaseOrderItemId;

        //  await JS.InvokeVoidAsync("alert", selectedGrowerId);
        // await JS.InvokeVoidAsync("alert", selectedItemid);

        var result = await EmployeeService.UnPostPurchaseOrder(EditModel);
        if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
        {
            GetOrderDetails = await EmployeeService.GetPurchaseOrder(selectedGrowerId);

            DialogMessage = result.RetMessage;
            ShowEmptyFieldDialogError = true;


            StateHasChanged();
            UnPostDialog = false; // Close the delete confirmation dialog
            return;
        }



        if (result != null && result.RetFlag.Trim() == "FALSE")
        {

            DialogMessage = result.RetMessage ?? "Failed to Unpost.";
            ShowEmptyFieldDialog = true;
            UnPostDialog = false;
            return;
        }

















        StateHasChanged();
        isDialogVisible = false;
    }
    protected async Task OnConfirmYesDelete()
    {
        // if (EditModel.CrissueId <= 0)
        // {
        //     DialogMessage = "Please enter a valid Id No";
        //     ShowEmptyFieldDialog = true;
        //     return;
        // }




        // await JS.InvokeVoidAsync("alert", selectedGrowerId);
        // await JS.InvokeVoidAsync("alert", selectedItemid);

        var result = await EmployeeService.DeleteCrateIssue(selectedGrowerId,EditModel);
        if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
        {

            GetDailyCrates=await EmployeeService.GetDailyCratesProcEmpty();

            DialogMessage = result.RetMessage;
            ShowEmptyFieldDialogError = true;


            StateHasChanged();
            DeleteDialog = false; // Close the delete confirmation dialog
            return;
        }



        if (result != null && result.RetFlag.Trim() == "FALSE")
        {

            DialogMessage = result.RetMessage ?? "Failed to delete Item group.";
            ShowEmptyFieldDialog = true;
            DeleteDialog = false;
            return;
        }

















        StateHasChanged();
        isDialogVisible = false;

    }

    protected async Task OnConfirmYesGenerate()
    {



        var result = await EmployeeService.GeneratePurchaseOrder(EditModel);
        if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
        {
            companyModel = await EmployeeService.GetPurchaseOrderNo();

            Purchaseorders = await EmployeeService.GetPurchaseorders();

            EditModel.PurchaseOrderId= companyModel.PurchaseOrderId;

            DialogMessage = result.RetMessage;
            ShowEmptyFieldDialogError = true;


            StateHasChanged();
            PurDialog = false; // Close the delete confirmation dialog
            return;
        }



        if (result != null && result.RetFlag.Trim() == "FALSE")
        {

            DialogMessage = result.RetMessage ?? "Failed to Create Purchase Order.";
            ShowEmptyFieldDialog = true;
            PurDialog = false;
            return;
        }

















        StateHasChanged();
        isDialogVisible = false;

    }














    private void OnConfirmNoDelete()
    {
        DeleteDialog = false;
    }






    private void ViewSubList(int growerId)
    {
        companyModel.Growerid = growerId;


        NavigationManager.NavigateTo($"/ViewSubGrower/{growerId}");

    }
    private async Task GoBack()
    {
        await JS.InvokeVoidAsync("history.back");
    }
    private void OnConfirmNoGenerate()
    {
        isDialogVisible = false;
    }


    private void OnConfirmNo()
    {
        isDialogVisible = false;
    }

    string GetRowCssClass(object dataItem, int visibleIndex)
    {
        return visibleIndex % 2 == 0 ? "even-row" : "odd-row";
    }

    private bool DeleteDialog = false;
    private bool PurDialog = false;
    private bool UnPostDialog = false;
    private bool PostDialog = false;
    private bool isDialogVisible = false;
    private int selectedGrowerId;
    private int selectedItemid;
    private string selectetGrowerGroup = null;
    private string selectedSubgrower = null;
    private decimal actualidqty = 0;
    private string Growerselect = null;
    private string selectedPurchaseGroup = null;
    private void ShowConfirmDialog(int GrowerId)
    {
        selectedGrowerId = GrowerId;
        isDialogVisible = true;


    }
    private void GoToAddGrowerPage()
    {
        NavigationManager.NavigateTo("/AddGrower");
    }






    void ChangeSearchMode(string key)
    {
        // CurrentSearchTextParseModeDisplayText = key;
        // CurrentSearchTextParseMode = SearchTextParseModes[key];
    }

    public void ShowDetails(int employeeId)
    {

    }
    public void ShowDetails1(string ename)
    {

    }
    public void ShowDetails2(string dept)
    {

    }
    // private string activeBreakpoint { get; set; }

    // // private List<Order> orders { get; set; }

    // private bool enableAdaptiveUIMode { get; set; }
    // private RowDirection renderingMode { get; set; }
    CompanyModel companyModel = new CompanyModel();
    IGrid MyGrid { get; set; }
    List<CompanyModel> Growers = new List<CompanyModel>();
    List<CompanyModel> banks = new List<CompanyModel>();
    List<CompanyModel> GetGstList = new List<CompanyModel>();
    List<CompanyModel> GetUomList = new List<CompanyModel>();
    List<CompanyModel> GetItemGroup = new List<CompanyModel>();
    List<CompanyModel> GetOrderDetails = new List<CompanyModel>();
    List<CompanyModel> GetCrateAnalysis = new List<CompanyModel>();
    List<CompanyModel> Cflaglist = new List<CompanyModel>();


    protected override async Task OnInitializedAsync()
    {
        GetgrowerList = await EmployeeService.GetallGrowerlist();
        Growers = await EmployeeService.GetItemname();
        GetVehlist = await EmployeeService.GetallVeh();
        Cflaglist = await EmployeeService.GetallCrateflagall();
        // Growers = await EmployeeService.GetallMasterSubGroup();
        // GetGstList = await EmployeeService.GetallPurchasegst();
        // GetUomList = await EmployeeService.GetallPurchaseuom();
        // banks = await EmployeeService.GetallPurchaseGroup();
        Purchaseorders = await EmployeeService.GetCrateordersEmpty();
        GetCrateMark=await EmployeeService.GetallCrateMarks();

        var Unitid = await ProtectedLocalStore.GetAsync<string>("Unitidno");


        int unit = Convert.ToInt32(Unitid.Value);

        Aggflag = true;
        Detflag = false;


        Growerslots=await EmployeeService.Getdraftdash(unit);
        // GetDailyCrates=await EmployeeService.GetDailyCratesProcOut();

        //  Growers = await EmployeeService.GetallMasterGroup();
    }
    // SfGrid<CompanyModel> Grid;

    // FilterSettings filterSettings = new FilterSettings { Type = FilterType.Excel };


    private async Task EditHandler(Employee employee)
    {
        // await Grid.SelectRowAsync(companyModel.chid);
        // await Grid.StartEditAsync();
    }


    private async Task DeleteHandler(Employee employee)
    {

    }

    protected async Task ViewOrder()
    {
        if (EditModel.PurchaseOrderId <= 0)
        {
            DialogMessage = "Please enter  valid Order No";
            ShowEmptyFieldDialog = true;
            return;
        }
        selectedGrowerId = EditModel.PurchaseOrderId;
        GetOrderDetails = await EmployeeService.GetPurchaseOrder(selectedGrowerId);

        companyModel = await EmployeeService.GetOrderhead(selectedGrowerId);
        EditModel.PurchaseOrderDated=companyModel.PurchaseOrderDated;
        EditModel.AccountName = companyModel.AccountName;
        EditModel.PurchaseOrderBillto = companyModel.PurchaseOrderBillto;
        EditModel.PurchaseOrderDel = companyModel.PurchaseOrderDel;
        EditModel.PurchaseOrderRemarks = companyModel.PurchaseOrderRemarks;






        StateHasChanged();
        return;



    }
    protected async Task SaveItem()
    {

        if (string.IsNullOrWhiteSpace(EditModel.PurchGrp))
        {
            DialogMessage = "Please Select  valid Purchase Group";
            ShowEmptyFieldDialog = true;
            return;

        }

        if (string.IsNullOrWhiteSpace(EditModel.PurchaseItemName))
        {
            DialogMessage = "Please Select  valid Item Group";
            ShowEmptyFieldDialog = true;
            return;

        }
        if (string.IsNullOrWhiteSpace(EditModel.PurchaseOrderItemDescrip))
        {
            EditModel.PurchaseOrderItemDescrip = "";


        }


        if (!EditModel.PurchaseOrderqty.HasValue || EditModel.PurchaseOrderqty <= 0)
        {
            DialogMessage = "Please enter a valid quantity greater than 0.";
            ShowEmptyFieldDialog = true;
            return;
        }
        if (EditModel.PurchaseOrderId <= 0)
        {
            DialogMessage = "Please enter a valid Order No";
            ShowEmptyFieldDialog = true;
            return;
        }

        var result = await EmployeeService.AddPurchaseOrderItem(EditModel);
        if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
        {
            DialogMessage = result.RetMessage;
            ShowEmptyFieldDialogError = true;


            companyModel = new CompanyModel();
            selectedGrowerId = EditModel.PurchaseOrderId;
            GetOrderDetails = await EmployeeService.GetPurchaseOrder(selectedGrowerId);

            StateHasChanged();
            return;
        }


        if (result != null && result.RetFlag.Trim() == "FALSE")
        {

            DialogMessage = result.RetMessage ?? "Failed to add order item.";
            ShowEmptyFieldDialog = true;

            return;
        }




    }


    protected async Task UpdateItem()
    {

        selectedItemid= EditModel.PurchaseOrderItemId;   
        //   await JS.InvokeVoidAsync("alert", selectedItemid);
        if (string.IsNullOrWhiteSpace(EditModel.PurchGrp))
        {
            DialogMessage = "Please Select  valid Purchase Group";
            ShowEmptyFieldDialog = true;
            return;

        }

        if (string.IsNullOrWhiteSpace(EditModel.PurchaseItemName))
        {
            DialogMessage = "Please Select  valid Item Group";
            ShowEmptyFieldDialog = true;
            return;

        }
        if (string.IsNullOrWhiteSpace(EditModel.PurchaseOrderItemDescrip))
        {
            EditModel.PurchaseOrderItemDescrip = "";


        }


        if (!EditModel.PurchaseOrderqty.HasValue || EditModel.PurchaseOrderqty <= 0)
        {
            DialogMessage = "Please enter a valid quantity greater than 0.";
            ShowEmptyFieldDialog = true;
            return;
        }
        if (EditModel.PurchaseOrderId <= 0)
        {
            DialogMessage = "Please enter a valid Order No";
            ShowEmptyFieldDialog = true;
            return;
        }

        var result = await EmployeeService.UpdatePurchaseOrderItem(EditModel);
        if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
        {
            DialogMessage = result.RetMessage;
            ShowEmptyFieldDialogError = true;


            companyModel = new CompanyModel();
            selectedGrowerId = EditModel.PurchaseOrderId;
            GetOrderDetails = await EmployeeService.GetPurchaseOrder(selectedGrowerId);

            StateHasChanged();
            return;
        }


        if (result != null && result.RetFlag.Trim() == "FALSE")
        {

            DialogMessage = result.RetMessage ?? "Failed to add order item.";
            ShowEmptyFieldDialog = true;

            return;
        }




    }




    private int? GetNumberBeforeHyphen(string input)
    {
        if (string.IsNullOrWhiteSpace(input))
            return null;

        var match = Regex.Match(input, @"^0*(\d+)-");
        if (!match.Success)
            return null;

        if (int.TryParse(match.Groups[1].Value, out int result))
            return result;

        return null;
    }



    protected async Task  SearchCrates()


    {
        DateTime DateFrom = EditModel.draftdatefrom ?? DateTime.Now;
        DateTime Dateto = EditModel.DraftDateTo ?? DateTime.Now;
        var partyId = GetNumberBeforeHyphen(EditModel.GrowerGroupName);
        if (string.IsNullOrWhiteSpace(EditModel.GrowerGroupName))
        {
            companyModel.Partyid = 0;
        }
        else
        {

            companyModel.Partyid = partyId.HasValue ? partyId.Value : 0;
        }

        int selectedpartyid = companyModel.Partyid;

        if (string.IsNullOrWhiteSpace(EditModel.stockType))
        {
            DialogMessage = "Please Select  valid stock  type";
            ShowEmptyFieldDialog = true;
            return;

        }


        if (string.IsNullOrWhiteSpace(EditModel.ReportType))
        {
            DialogMessage = "Please Select  valid report  type";
            ShowEmptyFieldDialog = true;
            return;

        }


        var Unitid = await ProtectedLocalStore.GetAsync<string>("Unitidno");


        int unit = Convert.ToInt32(Unitid.Value);
        EditModel.Partyid = companyModel.Partyid;




        if (EditModel.ReportType?.Trim() == "Detailed")

        {
            Detflag = true;
            Aggflag = false;


            if (EditModel.stockType?.Trim() == "ALL")

            {
                Detflag = true;
                Aggflag = false;





                Growerslots = await EmployeeService.Getdraftdashdetail(unit, selectedpartyid);
                return;
            
            
            
            
            
            
            
            
            
            }

















            if (EditModel.stockType?.Trim() == "Available")

            {
                Detflag = true;
                Aggflag = false;




                Growerslots = await EmployeeService.Getdraftdashdetailavail(unit, selectedpartyid);
                return;
            }




            
            if (EditModel.stockType?.Trim() == "Finished")

            {
                Detflag = true;
                Aggflag = false;




                Growerslots = await EmployeeService.Getdraftdashdetailfinish(unit, selectedpartyid);
                  return;
            }





        
        
        }












        if (EditModel.ReportType == "Aggregate")

        {
            Detflag = false;
            Aggflag = true;

            Growerslots = await EmployeeService.Getdraftdash(unit);
        }






    }


    private bool isProcessing = false;

    async Task SaveUnit()
    {
        if (isProcessing) return;
        isProcessing = true;

        try 


        {
            myGrid.ClearFilter();
            StateHasChanged();

            EditModel.GrowerGroupName = AvailGrower;

            if (string.IsNullOrWhiteSpace(EditModel.GrowerGroupName))
            {
                DialogMessage = "Please Select  valid Grower Group Name";
                ShowEmptyFieldDialog = true;
                return;

            }


            if (string.IsNullOrWhiteSpace(EditModel.GrowerName))
            {
                DialogMessage = "Please Select  valid Grower  Name";
                ShowEmptyFieldDialog = true;
                return;

            }

            if (string.IsNullOrWhiteSpace(EditModel.ChallanName))
            {
                DialogMessage = "Please Select  valid Challan  Name";
                ShowEmptyFieldDialog = true;
                return;

            }

            if (string.IsNullOrWhiteSpace(EditModel.CrissueMark))
            {
                DialogMessage = "Please Select  valid Crate  Mark";
                ShowEmptyFieldDialog = true;
                return;

            }

            if (string.IsNullOrWhiteSpace(EditModel.Vehno))
            {
                DialogMessage = "Please Select  valid Vehicle No";
                ShowEmptyFieldDialog = true;
                return;

            }



            if (string.IsNullOrWhiteSpace(EditModel.CrissueFlag))
            {
                DialogMessage = "Please Select  valid Transaction Flag";
                ShowEmptyFieldDialog = true;
                return;

            }
            if (string.IsNullOrWhiteSpace(EditModel.CrissueRemarks))
            {
                EditModel.CrissueRemarks = "";

            }

            if (!EditModel.CrissueQty.HasValue || EditModel.CrissueQty <= 0)
            {
                DialogMessage = "Please enter a valid quantity greater than 0.";
                ShowEmptyFieldDialog = true;
                return;
            }
            string selectedflag=EditModel.CrissueFlag;
            selectetGrowerGroup=EditModel.GrowerGroupName;
            GetCrateAnalysis = await EmployeeService.CheckCratesPartyOut(selectetGrowerGroup,selectedflag);

            decimal GrowerAvail = GetCrateAnalysis.FirstOrDefault()?.CrateAvailable ?? 0;




            if (EditModel.CrissueQty > GrowerAvail)
            {
                DialogMessage = $"Entered quantity cannot exceed available grower group quantity ({GrowerAvail}).";
                ShowEmptyFieldDialog = true;
                return;
            }


            selectedSubgrower=EditModel.GrowerName;
            GetCrateAnalysis = await EmployeeService.CheckCratesPartysubOut(selectedSubgrower,selectetGrowerGroup,selectedflag);



            decimal SubGrowerAvail = GetCrateAnalysis.FirstOrDefault()?.CrateAvailable ?? 0;











            //SubGrowerAvail = GetCrateAnalysis.FirstOrDefault()?.CrateAgreement ?? 0-GetCrateAnalysis.FirstOrDefault()?.CrateAvailable ?? 0;



            if (EditModel.CrissueQty > SubGrowerAvail)
            {
                DialogMessage = $"Entered quantity cannot exceed balance quantity ({SubGrowerAvail}).";
                ShowEmptyFieldDialog = true;
                return;
            }




            var result = await EmployeeService.addCrateOut(EditModel);
            if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
            {
                DialogMessage = result.RetMessage;
                ShowEmptyFieldDialogError = true;

                ShowCrateAnalysis = false;


                GetDailyCrates=await EmployeeService.GetDailyCratesProcOut();

                //      //  
                //      // // GetCrateMark=await EmployeeService.GetallCrateMarks();
                //      //      companyModel = await EmployeeService.GetCrateOrderNo();
                //GrowerGroupKey = Guid.NewGuid().ToString();

                EditModel.GrowerGroupName = String.Empty;
                EditModel.ChallanName = String.Empty;
                // EditModel.CrissueMark = String.Empty;
                EditModel.CrissueRemarks = "";
                EditModel.CrissueQty = 0;
                EditModel.CrissueMark = String.Empty;
                EditModel.Vehno = String.Empty;
                EditModel.GrowerName = String.Empty;
                selectedSubgrower= String.Empty;
                Purchaseorders = await EmployeeService.GetCrateorders();
                companyModel = await EmployeeService.GetCrateOrderNo();

            }


            if (result != null && result.RetFlag.Trim() == "FALSE")
            {

                DialogMessage = result.RetMessage ?? "Failed to add Master Group.";
                ShowEmptyFieldDialog = true;

                return;
            }



        }
        finally
        {
            isProcessing = false;
        }
    }








    protected async Task PostOrder()
    {
        if (EditModel.PurchaseOrderId <= 0)
        {
            DialogMessage = "Please enter a valid Order No";
            ShowEmptyFieldDialog = true;
            return;
        }
        selectedGrowerId = EditModel.PurchaseOrderId;
        companyModel = await EmployeeService.CheckPurchaseOrder(selectedGrowerId);


        string Orderstat = companyModel.PurchaseOrderStatus;

        if (Orderstat== "POST")
        {
            DialogMessage = "Order is already Posted";
            ShowEmptyFieldDialog = true;
            return;
        }

        if (Orderstat == "UNPOST")
        {

            PostDialog = true;
            return;
        }


    }
    protected async Task UnpostOrder()
    {
        if (EditModel.PurchaseOrderId <= 0)
        {
            DialogMessage = "Please enter a valid Order No";
            ShowEmptyFieldDialog = true;
            return;
        }
        selectedGrowerId = EditModel.PurchaseOrderId;
        companyModel = await EmployeeService.CheckPurchaseOrder(selectedGrowerId);


        string Orderstat = companyModel.PurchaseOrderStatus;

        if (Orderstat == "UNPOST")
        {
            DialogMessage = "Order is not Posted";
            ShowEmptyFieldDialog = true;
            return;
        }

        if (Orderstat == "POST")
        {

            UnPostDialog = true;
            return;
        }


    }

    protected async Task ClearFilter()
    {

        showReport = false;
  //       EditModel.Vehno = String.Empty;
  //  EditModel.Vehntype = String.Empty;
  // EditModel.VehContact = String.Empty;
  //  EditModel.VehDriver = String.Empty;
  
            EditModel.GrowerGroupName =null;
        EditModel.ChallanName = null;
 
           EditModel.GrowerName = null;
  //           selectedSubgrower= String.Empty;

      }



    protected async Task UpdateCrateIssue()
    {

      //  EditModel.GrowerGroupName = AvailGrower;

        selectedGrowerId = EditModel.CrissueId;
        if (string.IsNullOrWhiteSpace(EditModel.GrowerGroupName))
        {
            DialogMessage = "Please Select  valid Grower Group Name";
            ShowEmptyFieldDialog = true;
            return;

        }

        if  (EditModel.CrissueId <= 0)
        {
            DialogMessage = "Please enter a valid idno greater than 0.";
            ShowEmptyFieldDialog = true;
            return;
        }

        if (string.IsNullOrWhiteSpace(EditModel.GrowerName))
        {
            DialogMessage = "Please Select  valid Grower  Name";
            ShowEmptyFieldDialog = true;
            return;

        }

        if (string.IsNullOrWhiteSpace(EditModel.ChallanName))
        {
            DialogMessage = "Please Select  valid Challan  Name";
            ShowEmptyFieldDialog = true;
            return;

        }

        if (string.IsNullOrWhiteSpace(EditModel.CrissueMark))
        {
            DialogMessage = "Please Select  valid Crate  Mark";
            ShowEmptyFieldDialog = true;
            return;

        }

        if (string.IsNullOrWhiteSpace(EditModel.Vehno))
        {
            DialogMessage = "Please Select  valid Vehicle No";
            ShowEmptyFieldDialog = true;
            return;

        }
        if (string.IsNullOrWhiteSpace(EditModel.CrissueRemarks))
        {
            EditModel.CrissueRemarks = "";

        }

        if (!EditModel.CrissueQty.HasValue || EditModel.CrissueQty <= 0)
        {
            DialogMessage = "Please enter a valid quantity greater than 0.";
            ShowEmptyFieldDialog = true;
            return;
        }
         string selectedflag=EditModel.CrissueFlag;
        selectetGrowerGroup=EditModel.GrowerGroupName;
        GetCrateAnalysis = await EmployeeService.CheckCratesPartyOut(selectetGrowerGroup,selectedflag);
        decimal GrowerAvail =  GetCrateAnalysis.FirstOrDefault()?.CrateAvailable ?? 0;
           // // await JS.InvokeVoidAsync("alert",GrowerAvail);
              // // await JS.InvokeVoidAsync("alert",actualidqty);
        GrowerAvail = GrowerAvail + actualidqty;
     
           // // await JS.InvokeVoidAsync("alert",GrowerAvail);
        if (EditModel.CrissueQty > GrowerAvail)
        {
            DialogMessage = $"Entered quantity cannot exceed balance grower group quantity ({GrowerAvail}).";
            ShowEmptyFieldDialog = true;
            return;
        }

       
        selectedSubgrower=EditModel.GrowerName;
        GetCrateAnalysis = await EmployeeService.CheckCratesPartysubOut(selectedSubgrower,selectetGrowerGroup,selectedflag);

        decimal SubGrowerAvail = GetCrateAnalysis.FirstOrDefault()?.CrateAvailable ?? 0;

        SubGrowerAvail = SubGrowerAvail + actualidqty;


        if (EditModel.CrissueQty > SubGrowerAvail)
        {
            DialogMessage = $"Entered quantity cannot exceed balance grower quantity ({SubGrowerAvail}).";
            ShowEmptyFieldDialog = true;
            return;
        }

       
        var result = await EmployeeService.UpdateCrateIssueout(EditModel);
        if (result != null && result.RetFlag.Trim() == "TRUE" && !string.IsNullOrEmpty(result.RetMessage))
        {
            DialogMessage = result.RetMessage;
            ShowEmptyFieldDialogError = true;

            ShowCrateAnalysis = false;



            GetDailyCrates=await EmployeeService.GetDailyCratesProcOut();

            //      //  
            //      // // GetCrateMark=await EmployeeService.GetallCrateMarks();
            //      //      companyModel = await EmployeeService.GetCrateOrderNo();
            //GrowerGroupKey = Guid.NewGuid().ToString();
        
            EditModel.GrowerGroupName = String.Empty;
            EditModel.ChallanName = String.Empty;
           // EditModel.CrissueMark = String.Empty;
            EditModel.CrissueRemarks = "";
             EditModel.CrissueQty = 0;
             EditModel.CrissueMark = String.Empty;
             EditModel.Vehno = String.Empty;
               EditModel.GrowerName = String.Empty;
               selectedSubgrower= String.Empty;
               Purchaseorders = await EmployeeService.GetCrateorders();
               companyModel = await EmployeeService.GetCrateOrderNo();
            StateHasChanged();
            return;
        }


        if (result != null && result.RetFlag.Trim() == "FALSE")
        {

            DialogMessage = result.RetMessage ?? "Failed to add crate Out.";
            ShowEmptyFieldDialog = true;

            return;
        }




        






    }



    void Grid_CustomizeElement(GridCustomizeElementEventArgs e)
    {
        if (e.ElementType == GridElementType.DataRow && e.VisibleIndex % 2 == 1)
        {
            e.CssClass = "alt-item";
        }
        if (e.ElementType == GridElementType.HeaderCell)
        {
            e.Style = "background-color: var(--DS-color-surface-neutral-default-selected)";
            e.CssClass = "header-bold";
        }


    }


    public class Order
    {
        public int? OrderID { get; set; }
        public string CustomerID { get; set; }
        public DateTime? OrderDate { get; set; }
        public double? Freight { get; set; }
    }
}