@page "/Building"

@inject EmployeeAdoNetService EmployeeService

@using BlazorDemo.Services;
@using BlazorDemo;
@inject IJSRuntime JS

<style>
    .centered-field {
        display: flex;
        flex-direction: column;
        align-items: center; /* centers children horizontally */
    }

        .centered-field label {
            text-align: center; /* centers the label’s text */
            width: 100%; /* ensure the label fills the container */
            margin-bottom: .5rem;
        }

        .centered-field input {
            width: 200px; /* or whatever width you like */
        }

    /* Slightly darker but still subtle placeholder */
    .input-placeholder-dim::placeholder {
        color: rgba(130, 130, 130, 0.3) !important; /* dim gray, 30% opacity */
        opacity: 1 !important;
    }

    /* Dark gray border on focus, no shadow */
    .input-focus-dark:focus {
        border-color: #343a40; /* dark gray */
        box-shadow: none !important;
        outline: none;
    }

    .table-responsive {
        overflow-x: auto;
        width: 100%;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem; /* optional small font */
    }

        .table th, .table td {
            padding: 0.5rem;
            text-align: left;
        }

    .zebra-table tbody tr:nth-child(odd) {
        background-color: white;
    }

    .zebra-table tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }




    /* Custom small font */
    .small-font {
        font-size: 0.82rem;
    }

    .control-wrapper {
        max-width: 250px;
        margin: 0 auto;
        padding: 50px 0px 0px;
    }

    .example-label {
        font-size: 14px;
        margin-bottom: 6px;
        /* Standardize form control styles for horizontal alignment */
        input .form-control, .e-input-group, .e-control-wrapper, .e-autocomplete, .e-input

    {
        min-height: 38px; /* Bootstrap default */
        line-height: 1.5;
        font-size: 14px;
        font-family: 'Source Sans Pro', sans-serif;
        padding: 6px 12px;
        box-sizing: border-box;
    }

    /* Optional: Align content inside Syncfusion AutoComplete */
    .e-autocomplete .e-input {
        padding: 6px 12px !important;
    }

    /* Remove extra bottom spacing in SfAutoComplete wrapper */
    .e-autocomplete.e-control-wrapper {
        margin-bottom: 0 !important;
    }

    /* Align labels consistently */
    label.form-label {
        font-size: 14px;
        margin-bottom: 4px;
        font-family: 'Source Sans Pro', sans-serif;
    }

    /* Remove extra vertical margin if any Syncfusion adds it */
    .e-control-wrapper {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
    }

</style>

@if (ShowAlert)
{
    <div class="alert alert-danger alert-dismissible fade show position-fixed top-0 end-0 m-4 shadow"
         role="alert" style="z-index: 1050; min-width: 250px;">
        <alertmessage>Hello dear</alertmessage>

        <button type="button" class="btn-close" @onclick="() => ShowAlert = false"></button>
    </div>
}

<div class="d-flex justify-content-end gap-1">
    <!-- gap-3 = 1rem (~16px) spacing -->

    <button @onclick="GoBack" class="btn btn-primary">
        <i class="fa fa-arrow-left"></i>
    </button>

</div>




<div class="row g-4">
    <!-- Left Form (Single Column) -->
    <div class="d-flex justify-content-between align-items-center p-3 bg-light border-bottom">

        <h6><strong>Building Details</strong></h6>
       </div>
       <div class="card p-3 mb-4">
            <div class="row g-3">




            <div class="col-sm-2">

                <label for="lastName"  class="centered-field">Building Code</label>
                <InputText id="lastName" style="font-size: 14px; font-family: 'Source Sans Pro', sans-serif;" class="form-control input-placeholder-dim input-focus-dark" @bind-Value="companyModel.Bucode" />
            </div>


            <div class="col-sm-3">

                <label for="lastName" class="centered-field">Building Name</label>
                <InputText id="lastName" style="font-size: 14px; font-family: 'Source Sans Pro', sans-serif;" class="form-control input-placeholder-dim input-focus-dark" @bind-Value="companyModel.Buildname" />
                </div>
                <div class="col-12 col-md-3">
                <label for="email" class="centered-field">Status</label>
                
            


                <select @bind="companyModel.Bustat" style="font-size: 14px; font-family: 'Source Sans Pro', sans-serif;" class="form-control input-placeholder-dim input-focus-dark">
                    <option value="">-- Please choose an option --</option>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                   
                </select>










            
            </div>
            <div class="col-12 col-md-3">
                <label for="email" class="centered-field">Description</label>
                <InputText id="email" style="font-size: 14px; font-family: 'Source Sans Pro', sans-serif;" class="form-control input-placeholder-dim input-focus-dark" @bind-Value="companyModel.Budetails" />
            </div>
                <div class="col-12 col-md-2 d-flex align-items-end">
                <button class="btn btn-primary btn-sm" @onclick="SaveUnit">Save</button>
                </div>
            </div>
        </div>
    </div>
    @if (banks == null)
{
    <img src="./basicloader.gif" />
}
else
{
        <!-- Responsive Table -->
    <div class="table-responsive">
        <table class="table table-sm small-font zebra-table">
            <thead class="table-light">
            <tr>
                <th>Id no</th>
                <th>Building Name</th>
                    <th>Building Code</th>
                <th>Status</th>
                    <th>Details</th>
                <th style="width: 150px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            
            @foreach (var banklist in banks)
            {
                    if (editingBank == banklist)
                    {
                        <tr>
                            <td>@banklist.Buid</td>
                            <td><input class="form-control form-control-sm" @bind="banklist.Buildname" /></td>

                            <td><input class="form-control form-control-sm" @bind="banklist.Bucode" /></td>


                            <td>
                                <select @bind="banklist.Bustat" style="font-size: 14px; font-family: 'Source Sans Pro', sans-serif;" class="form-control input-placeholder-dim input-focus-dark">
                                    <option value="">-- Please choose an option --</option>
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>

                                </select>
                            </td>


                            <td><input class="form-control form-control-sm" @bind="banklist.Budetails" /></td>
                            <td>
                                <button class="btn btn-sm btn-success" @onclick="() => SaveEdit(banklist)">Save</button>
                                <button class="btn btn-sm btn-secondary ms-2" @onclick="CancelEdit">Cancel</button>
                            </td>
                        </tr>
                    }
                    else
                    {
                
                
                
                
                
                
                <tr>
                    <td>@banklist.Buid</td>
                            <td>@banklist.Buildname</td>

                            <td>@banklist.Bucode</td>
                            <td>@banklist.Bustat</td>
                            <td>@banklist.Budetails</td>
                    
                    <td>
                                <button class="btn btn-sm btn-primary" @onclick="() => EditBank(banklist)">Edit</button>
                                <button class="btn btn-sm btn-danger ms-2" @onclick="() => DeleteUnit(banklist)">
                                    Delete
                                </button>
                        
                        </td>
                </tr>
            }
            }
            
        </tbody>
    </table>
</div>
}

@code {
    private bool IsReadOnly { get; set; } = true;
    private bool ShowAlert = false;
    private bool ShowInputError = false;
   // private FormModel formModel = new();
    //private List<FormModel> rows = new();
    private int editIndex = -1;
      private String alertmessage = "";
    private CompanyModel SelectedEmployee { get; set; } = new CompanyModel();
                private CompanyModel editingBank = null!; // row being edited
                private CompanyModel editingBackup = null!; // optional: backup to cancel
}




@code {
    void EditBank(CompanyModel banklist)
    {
        editingBackup = new CompanyModel
            {
                Buid = banklist.Buid,
                Buildname = banklist.Buildname,

                Bucode = banklist.Bucode,
                Bustat = banklist.Bustat,
                Budetails = banklist.Budetails

            };
        editingBank = banklist;
    }


    private async Task GoBack()
    {
        await JS.InvokeVoidAsync("history.back");
    }
    protected async Task SaveEdit(CompanyModel companyModel)
    {

        if (string.IsNullOrWhiteSpace(editingBank.Buildname))
        {
            await JS.InvokeVoidAsync("alert", "Building Name Required.");


            return;
        }


        if (string.IsNullOrWhiteSpace(editingBank.Bucode))
        {
            await JS.InvokeVoidAsync("alert", "Building code Required.");



            return;
        }
        if (string.IsNullOrWhiteSpace(editingBank.Bustat))
        {
            await JS.InvokeVoidAsync("alert", "Building Status Required.");



            return;

        }
        await EmployeeService.updateBuilding(id, companyModel);
        IsReadOnly = true;
        banks = await EmployeeService.GetallBuildings();
        await JS.InvokeVoidAsync("alert", "Building Saved successfully.");

        StateHasChanged();


        editingBank = null!;
    }
    void CancelEdit()
    {
        if (editingBank is not null && editingBackup is not null)
        {
            editingBank.Bucode = editingBackup.Bucode;
            editingBank.Buildname = editingBackup.Buildname;
            editingBank.Bustat = editingBackup.Bustat;
            editingBank.Budetails = editingBackup.Budetails;
        }
        editingBank = null!;
    }
    protected async Task DeleteUnit(CompanyModel companyModel)
    {
        bool confirmed = await JS.InvokeAsync<bool>("confirm", $"Are you sure you want to delete item with ID {id}?");
        if (confirmed)
        {


            await EmployeeService.DeleteBuilding(id, companyModel);
            IsReadOnly = true;
            banks = await EmployeeService.GetallBuildings();
            await JS.InvokeVoidAsync("alert", "Building Deleted successfully.");

            StateHasChanged();


            editingBank = null!;
        }


    }











    public class GameFields
    {
        public string Id { get; set; } = "";
        public string Text { get; set; } = "";
    }
    public List<GameFields> Games = new List<GameFields>()
    {
        new GameFields() { Id = "Game1", Text = "State Bank of India" },
        new GameFields() { Id = "Game2", Text = "J&K Bank" },
        new GameFields() { Id = "Game3", Text = "HDFC bank" },
        new GameFields() { Id = "Game4", Text = "ICICI Bank" },
        new GameFields() { Id = "Game5", Text = "Indus Ind Bank" },
        new GameFields() { Id = "Game6", Text = "Punjab National Bank" },
        new GameFields() { Id = "Game7", Text = "Axis Bank" },
        new GameFields() { Id = "Game8", Text = "Canara Bank" },
        new GameFields() { Id = "Game9", Text = "Kotak Mahindra Bank" },
        new GameFields() { Id = "Game10", Text = "IDBI Bank" }
    };



    [Parameter]
    public int companyId { get; set; } = 1;
    CompanyModel companyModel = new CompanyModel();


    List<CompanyModel> banks = new List<CompanyModel>();



    protected override async Task OnInitializedAsync()
    {
        companyModel = await EmployeeService.GetCompanyByIdAsync(companyId);

        banks = await EmployeeService.GetallBuildings();


    }




    private void MakeReadOnly()
    {
        IsReadOnly = false;
    }

    public int id { get; set; } = 1;

    private string Caddress = "";

    protected async Task UpdateCompany()
    {

        if (string.IsNullOrWhiteSpace(companyModel.Caddress))
        {
            ShowAlert = true;
            ShowInputError = true;

            await Task.Delay(3000);
            ShowAlert = false;
            StateHasChanged();
            return;
        }


        if (string.IsNullOrWhiteSpace(companyModel.Name))
        {
            ShowAlert = true;
            ShowInputError = true;

            await Task.Delay(3000);
            ShowAlert = false;
            StateHasChanged();
            return;
        }



        await EmployeeService.EditCompany(id, companyModel);
        IsReadOnly = true;
        await JS.InvokeVoidAsync("alert", "Company updated successfully.");

        // // Optional: auto-hide the alert after a few seconds
        // await Task.Delay(3000);
        // ShowAlert = false;
        // StateHasChanged();
    }

    protected async Task SaveUnit()
    {

        if (string.IsNullOrWhiteSpace(companyModel.Bucode))
        {
            await JS.InvokeVoidAsync("alert", "Building code Required.");


            return;
        }


        if (string.IsNullOrWhiteSpace(companyModel.Buildname))
        {
            await JS.InvokeVoidAsync("alert", "Building Name Required.");



            return;
        }
        if (string.IsNullOrWhiteSpace(companyModel.Bustat))
        {
            await JS.InvokeVoidAsync("alert", "Building Status Required.");



            return;

        }

        await EmployeeService.AddBuilding(companyModel);
        IsReadOnly = true;
        banks = await EmployeeService.GetallBuildings();
        await JS.InvokeVoidAsync("alert", "Building Added successfully.");

         StateHasChanged();
    }














}




